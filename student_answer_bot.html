<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Answer Bot — Simple + Diagram</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1220; /* deep navy */
      --card: #111a2f;
      --muted: #a9b3c9;
      --text: #e8eeff;
      --accent: #7aa2ff;
      --accent-2: #50c878;
      --border: #1b2744;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: radial-gradient(1200px 800px at 80% -10%, #233053 0%, var(--bg) 50%) fixed, var(--bg); color: var(--text); }
    .wrap { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    header { display:flex; align-items:center; gap:14px; margin-bottom: 18px; }
    header h1 { font-size: 28px; margin: 0; letter-spacing: 0.2px; }
    header .chip { font-size: 12px; color: var(--muted); background: #0d1530; border:1px solid var(--border); padding: 6px 10px; border-radius: 999px; }

    .card { background: linear-gradient(180deg, rgba(122,162,255,0.06), rgba(122,162,255,0)); border: 1px solid var(--border); border-radius: 18px; padding: 16px; box-shadow: 0 30px 80px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.03); }

    .row { display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 980px) { .row { grid-template-columns: 440px 1fr; } }

    .search { display:flex; gap:10px; }
    .search input { flex:1; background:#0d1530; border:1px solid var(--border); color:var(--text); padding:14px 14px; border-radius:12px; outline:none; font-size:15px; }
    .search button { background: linear-gradient(180deg, var(--accent), #5682ff); color: white; border: none; padding: 12px 16px; border-radius: 12px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 24px rgba(122,162,255,0.35); }
    .search button.secondary { background: linear-gradient(180deg, #2a3e77, #203363); box-shadow: none; font-weight:600; }

    .small { font-size: 12px; color: var(--muted); }
    .muted { color: var(--muted); }

    .answer { line-height: 1.65; }
    .answer h2 { margin: 12px 0 8px; font-size: 18px; }
    .answer p, .answer li { color: #dbe4ff; }
    .source { margin-top: 8px; font-size:12px; }
    .source a { color: var(--accent); text-decoration: none; }

    .diag { overflow: auto; border: 1px dashed var(--border); border-radius: 14px; padding: 8px; min-height: 140px; }

    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; background:#0d1530; border:1px solid var(--border); color: var(--muted); font-size:12px; }

    .tips { display:flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .tips button { border:1px solid var(--border); background:#0d1530; color:var(--text); border-radius:999px; padding:8px 12px; cursor:pointer; }

    .loading { display:none; gap:8px; align-items:center; color: var(--muted); font-size:14px; }
    .dot { width:6px; height:6px; border-radius:50%; background: var(--accent); animation: blink 0.9s infinite alternate; }
    .dot:nth-child(2) { animation-delay: .15s }
    .dot:nth-child(3) { animation-delay: .3s }
    @keyframes blink { from { opacity: .2 } to { opacity: 1 } }

    footer { margin: 30px 0 10px; text-align:center; color: var(--muted); font-size: 12px; }
    .kbd { background: #101b35; color: #cdd9ff; border:1px solid var(--border); border-bottom-width: 2px; border-radius: 6px; padding: 0 6px; }
  </style>
  <!-- Mermaid for diagrams -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad:false, theme: 'dark' });</script>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7l10 5 10-5-10-5Zm0 7L2 4v13l10 5 10-5V4l-10 5Z" stroke="#7aa2ff" stroke-width="1.3"/></svg>
      <h1>Student Answer Bot</h1>
      <span class="chip">simple language · pulls from the internet</span>
    </header>

    <div class="row">
      <div class="card">
        <div class="small">Ask any question. I'll fetch info from Wikipedia/Simple Wikipedia and simplify it.</div>
        <div class="search" style="margin-top:8px">
          <input id="q" placeholder="e.g., What is photosynthesis?" />
          <button id="askBtn">Ask</button>
        </div>
        <div class="tips">
          <button data-sample="What is a black hole?">What is a black hole?</button>
          <button data-sample="Explain Newton's three laws in simple words">Newton's laws</button>
          <button data-sample="How does the water cycle work?">Water cycle</button>
          <button data-sample="What is the Pythagorean theorem?">Pythagorean theorem</button>
        </div>
        <div class="loading" id="loading" style="margin-top:10px">
          <div class="dot"></div><div class="dot"></div><div class="dot"></div>
          <span>Searching the web and simplifying…</span>
        </div>
        <div class="small" style="margin-top:10px">Tip: Press <span class="kbd">Enter</span> to search.</div>
      </div>

      <div class="card">
        <div style="display:flex; align-items:center; justify-content: space-between; gap:12px">
          <div class="small">Auto‑diagram from page sections</div>
          <div class="small">engine: Mermaid</div>
        </div>
        <div id="diagram" class="diag"></div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div id="answer" class="answer"></div>
      <div id="sources" class="source"></div>
    </div>

    <footer>
      Built with public APIs. For best results, try concrete concepts. Sources are shown below each answer.
    </footer>
  </div>

<script>
// --- Helpers to call Wikipedia (normal + Simple English) ---
async function wikiSearch(query) {
  // Search on regular Wikipedia
  const url = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
  const res = await fetch(url);
  if (!res.ok) throw new Error('Search failed');
  const data = await res.json();
  const title = data?.query?.search?.[0]?.title;
  return title || null;
}

async function wikiSummary(title, simple=false) {
  const base = simple ? 'https://simple.wikipedia.org' : 'https://en.wikipedia.org';
  const url = `${base}/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
  const res = await fetch(url);
  if (!res.ok) return null; // may not exist on Simple
  return res.json();
}

async function wikiSections(title) {
  const url = `https://en.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(title)}&prop=sections&format=json&origin=*`;
  const res = await fetch(url);
  if (!res.ok) return [];
  const data = await res.json();
  return data?.parse?.sections || [];
}

// --- Simplify text: short sentences, simpler words (naive rules) ---
function simplifyText(text) {
  if (!text) return '';
  // Keep it short: 6-10 sentences.
  const sentences = text
    .replace(/\s+/g,' ')
    .split(/(?<=[.!?])\s+/)
    .slice(0, 10);

  return sentences
    .map(s => s
      // Replace some complex words with simpler ones
      .replace(/utilize/gi, 'use')
      .replace(/approximately/gi, 'about')
      .replace(/demonstrate/gi, 'show')
      .replace(/numerous/gi, 'many')
      .replace(/consequently/gi, 'so')
      .replace(/therefore/gi, 'so')
      .replace(/significant/gi, 'important')
      .replace(/obtain/gi, 'get')
      .replace(/investigate/gi, 'study')
    )
    .join(' ');
}

function mdEscape(s) { return s.replace(/[<>]/g, c => ({'<':'&lt;','>':'&gt;'}[c])); }

// Build a simple Mermaid flowchart from top-level sections
function buildDiagram(title, sections) {
  if (!sections?.length) {
    return `flowchart TD\n A(\"${title}\"):::root`;
  }
  const tops = sections.filter(s => s.toclevel === 1).slice(0, 8);
  let lines = [`flowchart TD`, `A(\"${title}\"):::root`];
  tops.forEach((s, i) => {
    const id = `S${i}`;
    const clean = s.line.replace(/\"/g,'\\\"');
    lines.push(`${id}(\"${clean}\"); A-->${id}`);
  });
  lines.push(`classDef root fill:#1c2952,stroke:#6ea8ff,stroke-width:2px,color:#fff;`);
  return lines.join('\n');
}

function renderMermaid(diagramStr) {
  const el = document.getElementById('diagram');
  el.innerHTML = `<div class="mermaid">${diagramStr}</div>`;
  // @ts-ignore
  mermaid.run();
}

function showLoading(v) {
  document.getElementById('loading').style.display = v ? 'flex' : 'none';
}

function setAnswer(html) {
  document.getElementById('answer').innerHTML = html;
}

function setSources(urls) {
  const box = document.getElementById('sources');
  if (!urls?.length) { box.innerHTML = ''; return; }
  const links = urls.map(u => `<a href="${u}" target="_blank" rel="noopener">${u.replace(/^https?:\/\//,'')}</a>`).join(' · ');
  box.innerHTML = `<span class="muted">Sources:</span> ${links}`;
}

async function ask(query) {
  showLoading(true);
  setAnswer('');
  setSources([]);
  document.getElementById('diagram').innerHTML = '';

  try {
    const foundTitle = await wikiSearch(query);
    if (!foundTitle) {
      setAnswer(`<h2>Could not find a Wikipedia page.</h2><p class='muted'>Try being more specific, or check your spelling.</p>`);
      showLoading(false);
      return;
    }

    // Prefer Simple Wikipedia if available; else fall back to normal summary
    const simple = await wikiSummary(foundTitle, true);
    const normal = await wikiSummary(foundTitle, false);
    const use = simple?.extract?.length > 40 ? simple : normal;

    const title = use?.title || foundTitle;
    const extract = use?.extract || normal?.extract || '';
    const simplified = simplifyText(extract);

    // Sections for diagram
    const secs = await wikiSections(foundTitle);
    const diagram = buildDiagram(title, secs);
    renderMermaid(diagram);

    const thumb = use?.thumbnail?.source ? `<img src="${use.thumbnail.source}" alt="${mdEscape(title)}" style="max-width:140px;border-radius:10px;border:1px solid var(--border);float:right;margin:0 0 8px 12px"/>` : '';

    const html = `
      ${thumb}
      <h2>${mdEscape(title)}</h2>
      <p>${mdEscape(simplified)}</p>
      <h2>In short</h2>
      <ul>
        ${(extract.split(/(?<=[.!?])\s+/).slice(0,4).map(s=>`<li>${mdEscape(s)}</li>`)).join('')}
      </ul>
    `;
    setAnswer(html);

    const srcs = [];
    if (use?.content_urls?.desktop?.page) srcs.push(use.content_urls.desktop.page);
    if (use !== simple && simple?.content_urls?.desktop?.page) srcs.push(simple.content_urls.desktop.page);
    setSources(srcs);
  } catch (err) {
    console.error(err);
    setAnswer(`<h2>Oops, something went wrong.</h2><p class='muted'>Please try again.</p>`);
  } finally {
    showLoading(false);
  }
}

// UI wiring
const input = document.getElementById('q');
const btn = document.getElementById('askBtn');
btn.addEventListener('click', () => {
  const q = input.value.trim();
  if (q) ask(q);
});
input.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const q = input.value.trim();
    if (q) ask(q);
  }
});

document.querySelectorAll('.tips button').forEach(b => {
  b.addEventListener('click', () => {
    input.value = b.dataset.sample;
    ask(b.dataset.sample);
  });
});
</script>
</body>
</html>
